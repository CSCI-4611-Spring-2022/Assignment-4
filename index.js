var v=Object.defineProperty;var A=(r,e,t)=>e in r?v(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>(A(r,typeof e!="symbol"?e+"":e,t),t);import{W as T,S as P,P as B,C as F,V as N,a as y,M as c,G as L,F as R,E as g,b as E,Q as w,O as S,A as Q,c as z,D,T as k,d as C,e as H,f as I,g as j}from"./vendor.js";const W=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}};W();class X{constructor(e=60,t=1.333,s=1,i=1e3){n(this,"aspectRatio");n(this,"fov");n(this,"znear");n(this,"zfar");n(this,"renderer");n(this,"scene");n(this,"camera");n(this,"clock");this.fov=e,this.aspectRatio=t,this.znear=s,this.zfar=i,this.renderer=new T,this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.resize(),window.addEventListener("resize",()=>{this.resize()},!1),window.addEventListener("mousedown",o=>{this.onMouseDown(o)}),window.addEventListener("mouseup",o=>{this.onMouseUp(o)}),window.addEventListener("mousemove",o=>{this.onMouseMove(o)}),window.addEventListener("wheel",o=>{this.onMouseWheel(o)}),window.addEventListener("keydown",o=>{this.onKeyDown(o)}),window.addEventListener("keyup",o=>{this.onKeyUp(o)}),this.scene=new P,this.camera=new B(this.fov,this.aspectRatio,this.znear,this.zfar),this.clock=new F}start(){this.createScene(),this.mainLoop()}mainLoop(){this.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera),window.requestAnimationFrame(()=>this.mainLoop())}resize(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=new N;this.renderer.getViewport(e);var t=window.innerWidth/window.innerHeight;this.aspectRatio>t?this.renderer.setViewport(0,(window.innerHeight-window.innerWidth/this.aspectRatio)/2,window.innerWidth,window.innerWidth/this.aspectRatio):this.renderer.setViewport((window.innerWidth-window.innerHeight*this.aspectRatio)/2,0,window.innerHeight*this.aspectRatio,window.innerHeight)}onMouseDown(e){}onMouseUp(e){}onMouseMove(e){}onMouseWheel(e){}onKeyDown(e){}onKeyUp(e){}}class x{constructor(e){n(this,"tokens");n(this,"line");n(this,"token");this.tokens=[],this.line=0,this.token=0;const t=e.split(`
`);for(let s=0;s<t.length;s++)this.tokens.push(t[s].trim().split(/\s+/));for(let s=0;s<this.tokens.length;s++)this.tokens[s].length==1&&this.tokens[s][0]==""&&(this.tokens.splice(s,1),s--)}peek(){return this.tokens[this.line][this.token]}expect(e){return this.peek()==e?(this.readToken(),!0):!1}consumeLine(){this.line++,this.token=0}done(){return this.line>=this.tokens.length}readToken(){const e=this.tokens[this.line][this.token];return this.token++,this.token>=this.tokens[this.line].length&&(this.line++,this.token=0),e}readNumber(){return Number(this.readToken())}readLine(){const e=[];for(let t=this.token;t<this.tokens[this.line].length;t++)e.push(this.tokens[this.line][t]);return this.line++,this.token=0,e}}class U{constructor(){n(this,"name");n(this,"direction");n(this,"length");n(this,"dofs");n(this,"children");n(this,"boneToRotationSpace");n(this,"rotationToBoneSpace");n(this,"transform");this.name="",this.direction=new y,this.length=0,this.dofs=[!1,!1,!1],this.children=[],this.boneToRotationSpace=new c,this.rotationToBoneSpace=new c,this.transform=new L}createHierarchy(e){this.resetTransform(),e.add(this.transform),this.children.forEach(t=>{t.createHierarchy(this.transform)})}resetTransform(){this.transform.position.copy(this.direction),this.transform.position.multiplyScalar(this.length),this.transform.rotation.set(0,0,0)}update(e){}}const f=class{constructor(e){n(this,"usingDegrees");n(this,"bones");n(this,"loaded");n(this,"rootPosition");n(this,"rootRotation");n(this,"rootTransform");n(this,"rootBones");this.loaded=!1,this.usingDegrees=!1,this.bones=new Map,this.rootPosition=new y,this.rootRotation=new c,this.rootTransform=new L,this.rootBones=[],e.add(this.rootTransform)}static finishedLoading(){return f.numLoading==0}loadFromASF(e){console.log("Loading skeleton data from "+e+"..."),f.numLoading++,new R().load(e,s=>{const i=new x(s);for(;!i.done();){const o=i.readToken();if(o.charAt(0)=="#")i.consumeLine();else if(o==":units")this.parseUnits(i);else if(o==":root")this.parseRoot(i);else if(o==":bonedata")this.parseBoneData(i);else if(o==":hierarchy")this.parseHierarchy(i);else if(o==":version")i.consumeLine();else if(o==":name")i.consumeLine();else if(o==":documentation")for(;!i.done()&&i.peek().charAt(0)!=":";)i.consumeLine();else{console.error("Error: encountered unknown token: "+o);return}}console.log("Skeleton data loaded from "+e+"."),f.numLoading--,this.createHierarchy()})}parseUnits(e){let t;do t=!0,e.expect("mass")||e.expect("length")?(t=!1,e.consumeLine()):e.expect("angle")&&(t=!1,this.usingDegrees=e.readToken()=="deg");while(!t)}parseRoot(e){let t;do if(t=!0,e.expect("order")){if(t=!1,!e.expect("TX")||!e.expect("TY")||!e.expect("TZ")||!e.expect("RX")||!e.expect("RY")||!e.expect("RZ")){console.error("Error: order not in the order expected");return}}else if(e.expect("axis")){if(t=!1,!e.expect("XYZ")){console.error("Error: axis not in the order expected");return}}else if(e.expect("position"))t=!1,this.rootPosition.set(e.readNumber(),e.readNumber(),e.readNumber()),this.rootPosition.multiplyScalar(.056444);else if(e.expect("orientation")){t=!1;const s=new g(e.readNumber(),e.readNumber(),e.readNumber(),"ZYX");this.rootRotation.makeRotationFromEuler(s)}while(!t)}parseBoneData(e){for(;e.expect("begin");){const t=new U;for(;!e.expect("end");)if(e.expect("id"))e.consumeLine();else if(e.expect("name")){const s=e.readToken();t.name=s,this.bones.set(s,t)}else if(e.expect("direction"))t.direction.x=e.readNumber(),t.direction.y=e.readNumber(),t.direction.z=e.readNumber();else if(e.expect("length"))t.length=e.readNumber()*.056444;else if(e.expect("axis")){let s=e.readNumber(),i=e.readNumber(),o=e.readNumber();if(this.usingDegrees&&(s*=Math.PI/180,i*=Math.PI/180,o*=Math.PI/180),e.expect("XYZ")){const a=new g(s,i,o,"ZYX");t.rotationToBoneSpace.makeRotationFromEuler(a),t.boneToRotationSpace.copy(t.rotationToBoneSpace),t.boneToRotationSpace.invert()}else{console.error("Error: bone axis not in the order expected");return}}else e.expect("dof")?(t.dofs[0]=e.expect("rx"),t.dofs[1]=e.expect("ry"),t.dofs[2]=e.expect("rz")):e.expect("limits")&&(t.dofs[0]&&e.consumeLine(),t.dofs[1]&&e.consumeLine(),t.dofs[2]&&e.consumeLine())}}parseHierarchy(e){if(e.expect("begin"))for(;!e.expect("end");){const t=e.readToken();e.readLine().forEach(i=>{if(t=="root"){const o=this.bones.get(i);this.rootBones.push(o)}else{const o=this.bones.get(i);this.bones.get(t).children.push(o)}})}else console.error("Error: reading hierarchy, expected begin, found "+e.peek())}getBone(e){return this.bones.get(e)}createHierarchy(){this.rootBones.forEach(e=>{e.createHierarchy(this.rootTransform)})}update(e,t){this.rootTransform.rotation.set(0,0,0),this.rootTransform.applyMatrix4(this.rootRotation),this.rootTransform.applyMatrix4(e.rootRotation),t&&(this.rootTransform.position.copy(this.rootPosition),this.rootTransform.applyMatrix4(e.rootTranslation)),this.rootBones.forEach(s=>{s.update(e)})}};let b=f;n(b,"numLoading",0);class p{constructor(){n(this,"frame");n(this,"rootTranslation");n(this,"rootRotation");n(this,"jointRotations");this.frame=0,this.rootTranslation=new c,this.rootRotation=new c,this.jointRotations=new Map}setRootPosition(e){this.rootTranslation.makeTranslation(e.x,e.y,e.z)}getRootPosition(){const e=new y;return e.applyMatrix4(this.rootTranslation),e}setRootAngles(e){this.rootRotation.makeRotationFromEuler(e)}setJointAngles(e,t){const s=new c().makeRotationFromEuler(t);this.jointRotations.set(e.name,s)}getJointRotation(e){const t=this.jointRotations.get(e);return t||new c}setJointRotation(e,t){this.jointRotations.set(e,t)}lerp(e,t){this.frame=Math.round(E.lerp(this.frame,e.frame,t));const s=this.getRootPosition();s.lerp(e.getRootPosition(),t),this.rootTranslation.makeTranslation(s.x,s.y,s.z);const i=new w().setFromRotationMatrix(this.rootRotation);i.slerp(new w().setFromRotationMatrix(e.rootRotation),t),this.rootRotation.makeRotationFromQuaternion(i),this.jointRotations.forEach((o,a)=>{const m=new w().setFromRotationMatrix(o);m.slerp(new w().setFromRotationMatrix(e.getJointRotation(a)),t),o.makeRotationFromQuaternion(m)})}clone(){const e=new p;return e.frame=this.frame,e.rootRotation.copy(this.rootRotation),e.rootTranslation.copy(this.rootTranslation),this.jointRotations.forEach((t,s)=>{e.setJointRotation(s,t.clone())}),e}}const u=class{constructor(){n(this,"frames");this.frames=[]}static finishedLoading(){return u.numLoading==0}loadFromAMC(e,t){console.log("Loading motion data from "+e+"..."),u.numLoading++,new R().load(e,i=>{const o=new x(i);for(;!o.done();){for(;o.peek().charAt(0)=="#"||o.peek().charAt(0)==":";)o.consumeLine();for(;!o.done();){const a=new p;for(a.frame=o.readNumber();!o.done()&&isNaN(Number(o.peek()));){const m=o.readToken();if(m=="root"){const h=new y;h.x=o.readNumber()*.056444,h.y=o.readNumber()*.056444,h.z=o.readNumber()*.056444,a.setRootPosition(h);const l=new g;l.order="ZYX",l.x=o.readNumber()*Math.PI/180,l.y=o.readNumber()*Math.PI/180,l.z=o.readNumber()*Math.PI/180,a.setRootAngles(l)}else{const h=t.getBone(m),l=new g;l.order="ZYX",h.dofs[0]&&(l.x=o.readNumber()*Math.PI/180),h.dofs[1]&&(l.y=o.readNumber()*Math.PI/180),h.dofs[2]&&(l.z=o.readNumber()*Math.PI/180),a.setJointAngles(h,l)}}this.frames.push(a)}}console.log("Motion data loaded from "+e+"."),u.numLoading--})}trimFront(e){this.frames.splice(0,e)}trimBack(e){this.frames.splice(this.frames.length-e,e)}prependPose(e){this.frames.unshift(e)}appendPose(e){this.frames.push(e)}makeLoop(e){const t=new u;for(let s=0;s<e;s++)t.prependPose(this.frames.pop());for(let s=0;s<e;s++){const i=s/(t.frames.length-1);t.frames[s].lerp(this.frames[s],i),this.frames[s]=t.frames[s]}}};let d=u;n(d,"numLoading",0);class M extends S{constructor(e=60,t=!0){super();n(this,"skeleton");n(this,"fps");n(this,"useAbsolutePosition");n(this,"clip");n(this,"currentTime");n(this,"currentPose");n(this,"overlayQueue");n(this,"overlayTransitionFrames");n(this,"overlayTime");n(this,"overlayPose");this.skeleton=new b(this),this.fps=e,this.useAbsolutePosition=t,this.clip=null,this.currentTime=0,this.currentPose=new p,this.overlayQueue=[],this.overlayTransitionFrames=[],this.overlayTime=0,this.overlayPose=new p}createMeshes(e){e&&this.skeleton.rootTransform.add(new Q(.15)),this.skeleton.rootBones.forEach(t=>{this.createMeshesRecursive(t,e)})}createMeshesRecursive(e,t){}loadSkeleton(e){this.skeleton.loadFromASF(e)}loadMotionClip(e){const t=new d;return t.loadFromAMC(e,this.skeleton),t}play(e){this.stop(),this.clip=e,this.currentPose=this.clip.frames[0]}stop(){this.clip=null,this.currentTime=0,this.overlayQueue=[],this.overlayTransitionFrames=[],this.overlayTime=0}overlay(e,t){this.overlayQueue.push(e),this.overlayTransitionFrames.push(t)}update(e){if(!this.clip)return;this.currentTime+=e;let t=Math.floor(this.currentTime*this.fps);t>=this.clip.frames.length&&(t=0,this.currentTime=0,this.currentPose=this.clip.frames[0]);let s=0;this.overlayQueue.length>0&&(this.overlayTime+=e,s=Math.floor(this.overlayTime*this.fps),s>=this.overlayQueue[0].frames.length&&(this.overlayQueue.shift(),this.overlayTransitionFrames.shift(),this.overlayTime=0,s=0));const i=this.computePose(t,s);this.skeleton.update(i,this.useAbsolutePosition)}getQueueCount(){return this.overlayQueue.length}computePose(e,t){if(this.overlayQueue.length>0){const s=this.overlayQueue[0].frames[t].clone();let i=0;if(t<this.overlayTransitionFrames[0]?(i=1-t/this.overlayTransitionFrames[0],s.lerp(this.clip.frames[e],i)):t>this.overlayQueue[0].frames.length-this.overlayTransitionFrames[0]&&(i=1-(this.overlayQueue[0].frames.length-t)/this.overlayTransitionFrames[0],s.lerp(this.clip.frames[e],i)),!this.useAbsolutePosition){const o=this.overlayQueue[0].frames[t].getRootPosition();o.sub(this.overlayPose.getRootPosition());const a=this.clip.frames[e].getRootPosition();a.sub(this.currentPose.getRootPosition()),o.lerpVectors(o,a,i),this.position.add(o),this.overlayPose=this.overlayQueue[0].frames[t],this.currentPose=this.clip.frames[e]}return s}else{if(!this.useAbsolutePosition){const s=this.clip.frames[e].getRootPosition();s.sub(this.currentPose.getRootPosition()),this.position.add(s),this.currentPose=this.clip.frames[e]}return this.clip.frames[e]}}}class Y extends X{constructor(){super(60,1920/1080,.1,100);n(this,"salsaAntLead");n(this,"salsaAntFollow");n(this,"balletAnt");n(this,"salsaMotionLead");n(this,"salsaMotionFollow");n(this,"balletBaseLoop");n(this,"balletDanceMotions");n(this,"state");this.salsaAntLead=new M(60,!0),this.salsaAntFollow=new M(60,!0),this.balletAnt=new M(120,!1),this.salsaMotionLead=new d,this.salsaMotionFollow=new d,this.balletBaseLoop=new d,this.balletDanceMotions=[],this.state=0}createScene(){this.camera.position.set(0,1.5,3.5),this.camera.lookAt(0,1,0),this.camera.up.set(0,1,0);const e=new z("white",.3);this.scene.add(e);const t=new D("white",.6);t.position.set(0,2,1),this.scene.add(t),this.scene.background=new k().load("assets/images/ants-dance.jpg");const s=new C;s.map=new k().load("assets/images/woodfloor.jpg");const i=new H(new I(14,6));i.material=s,i.rotateX(-Math.PI/2),this.scene.add(i);const o=new j;o.width=100;const a=o.addFolder("Ballet Controls");a.open(),a.add(this,"playBalletMotion1").name("Motion 1"),a.add(this,"playBalletMotion2").name("Motion 2"),a.add(this,"playBalletMotion3").name("Motion 3"),a.add(this,"playBalletMotion4").name("Motion 4"),a.add(this,"playBalletMotion5").name("Motion 5"),this.salsaAntLead.position.set(1,0,.5),this.salsaAntFollow.position.set(1,0,.5),this.balletAnt.position.set(-2,.95,0),this.loadSkeletons()}loadSkeletons(){this.state=1,this.salsaAntLead.loadSkeleton("./assets/data/60.asf"),this.salsaAntFollow.loadSkeleton("./assets/data/61.asf"),this.balletAnt.loadSkeleton("./assets/data/61.asf")}loadAnimations(){this.state=2,this.salsaMotionLead=this.salsaAntLead.loadMotionClip("./assets/data/60_12.amc"),this.salsaMotionFollow=this.salsaAntLead.loadMotionClip("./assets/data/61_12.amc"),this.balletBaseLoop=this.balletAnt.loadMotionClip("./assets/data/05_20.amc"),this.balletDanceMotions.push(this.balletAnt.loadMotionClip("./assets/data/05_02.amc"))}startAnimations(){this.salsaMotionLead.trimFront(100),this.salsaMotionLead.trimBack(150),this.salsaMotionLead.makeLoop(100),this.salsaMotionFollow.trimFront(100),this.salsaMotionFollow.trimBack(150),this.salsaMotionFollow.makeLoop(100),this.balletBaseLoop.trimBack(600),this.balletBaseLoop.makeLoop(50),this.balletDanceMotions[0].trimFront(280),this.balletDanceMotions[0].trimBack(200);const e=!0;this.salsaAntLead.createMeshes(e),this.salsaAntFollow.createMeshes(e),this.balletAnt.createMeshes(e),this.salsaAntLead.play(this.salsaMotionLead),this.salsaAntFollow.play(this.salsaMotionFollow),this.balletAnt.play(this.balletBaseLoop),this.scene.add(this.salsaAntLead),this.scene.add(this.salsaAntFollow),this.scene.add(this.balletAnt)}update(e){if(this.state!=0){if(this.state==1)if(b.finishedLoading())this.loadAnimations();else return;if(this.state==2)if(d.finishedLoading())this.state=3,this.startAnimations();else return;this.salsaAntLead.update(e),this.salsaAntFollow.update(e),this.balletAnt.update(e)}}playBalletMotion1(){this.balletAnt.overlay(this.balletDanceMotions[0],100),console.log("Queueing ballet motion 1. Queue size is "+this.balletAnt.getQueueCount()+".")}playBalletMotion2(){}playBalletMotion3(){}playBalletMotion4(){}playBalletMotion5(){}}var Z=new Y;Z.start();
